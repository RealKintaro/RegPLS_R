library(data.table)
library(Hmisc)
library(pls)
library(MASS)


# function read data
read_data<-function(path2data, file_name){
  DM.dt <- fread(file.path(path2data, file_name))
  return(DM.dt)
}

# function to for regression
regression<-function(DM.dt , formula){
  # Regression multiple Y f(X1..X7)
  lm<-lm(formula =formula, 
         data=DM.dt)
  #print 
  print(lm) 
  #summary
  print(summary(lm)) 
  return(lm)
}

#  function for correlation
correlation<-function(DM.dt){
  DM_Matrix<-as.matrix(DM.dt)
  return (rcorr(DM_Matrix, type=c("pearson","spearman"))$r)
}

# function for scale
scale_data<-function(DM.dt){
  Scale_DM<-scale(DM.dt)
  return(Scale_DM)
}

# getting variables with p value < 0.05
get_significant_variables<-function(lm){
  # get p value
  p_value<-summary(lm)$coefficients[,4]
  # get variable names
  variable_names<-names(p_value)
  # get significant variables
  significant_variables<-variable_names[p_value>0.05]
  return(significant_variables)
}

# extract correlation values with Y
extract_correlation<-function(DM.dt, significant_variables){
  # get correlation values
  DM.dt <- as.matrix(DM.dt)
  correlation_values<-rcorr(DM_Matrix, type=c("pearson","spearman"))$r
  correlation_values <- correlation_values[,c(sigvars)]
  
  # get correlation values with Y
  correlation_values_with_Y<-correlation_values[c('Y'),]

  return(correlation_values_with_Y)
}

# Function to construct T1
construct_T1<-function(DM.dt, significant_variables, correlation_values_with_Y){
  # get T1
  T1<-DM.dt[,c(significant_variables)]
  # get correlation values with Y
  correlation_values_with_Y<-correlation_values_with_Y
  # get T1
  T1<-cbind(T1,correlation_values_with_Y)
  return(T1)
}

path2data<-file.path("c:","Users","makch","STUDIES",
                     "s3","ADD","RegPLSR")

data <- read_data(path2data,"Data_Cornell.csv")

lm <- regression(data,Y ~ 0 + X1 + X2+ X3 + X4 + X5 +X6 + X7)

cor = correlation(data)
cor

signifVars = get_significant_variables(lm)
